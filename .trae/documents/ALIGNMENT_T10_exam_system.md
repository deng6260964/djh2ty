# T10考试系统需求对齐文档

## 1. 项目上下文分析

### 1.1 现有项目架构
- **技术栈**: Flask 3.0 + SQLAlchemy 2.0 + JWT认证 + SQLite/PostgreSQL
- **架构模式**: 蓝图模块化架构，前后端分离
- **权限系统**: 基于角色的权限控制(RBAC)，支持admin/teacher/student三种角色
- **数据库设计**: 关系型数据库，支持迁移管理

### 1.2 已完成模块分析
- **T05 用户认证系统**: JWT认证、会话管理、权限控制
- **T06 用户管理系统**: 用户CRUD、角色管理、权限验证
- **T07 课程管理系统**: 课程CRUD、选课管理、权限控制
- **T08 作业管理系统**: 作业CRUD、文件上传、提交批改、统计功能
- **T09 题库管理系统**: 题库CRUD、题目CRUD、随机抽题、试卷生成

### 1.3 现有数据模型
- **User模型**: 用户基础信息，支持三种角色
- **Course模型**: 课程信息，支持一对一/一对多
- **CourseEnrollment模型**: 选课关系
- **Homework模型**: 作业信息，支持多种类型
- **HomeworkSubmission模型**: 作业提交记录
- **QuestionBank模型**: 题库信息，支持分类和难度
- **Question模型**: 题目信息，支持多种题型

## 2. 原始需求分析

### 2.1 核心功能需求
1. **考试管理**
   - 考试创建：教师/管理员可创建考试
   - 考试配置：设置考试时间、时长、题目、分值
   - 考试发布：控制考试的可见性和开始时间
   - 考试监控：实时查看考试进行状态

2. **在线考试**
   - 考试参与：学生在线参加考试
   - 答题界面：友好的答题交互界面
   - 自动保存：防止意外丢失答案
   - 时间控制：考试倒计时和自动提交

3. **自动评分**
   - 客观题自动评分：选择题、判断题、填空题
   - 主观题人工评分：作文题、口语题
   - 成绩计算：总分统计和等级评定

4. **成绩管理**
   - 成绩查看：学生查看个人成绩
   - 成绩统计：教师查看班级成绩分析
   - 成绩导出：支持Excel等格式导出

### 2.2 业务规则
1. **权限控制**
   - 管理员：可管理所有考试
   - 教师：可管理自己创建的考试
   - 学生：只能参加被分配的考试

2. **考试状态**
   - 草稿：未发布状态
   - 已发布：学生可见但未开始
   - 进行中：考试正在进行
   - 已结束：考试时间结束
   - 已评分：所有题目已评分

3. **答题限制**
   - 每个学生只能参加一次考试
   - 考试时间内必须完成
   - 离开页面有警告提示

## 3. 边界确认

### 3.1 功能边界
**包含功能**:
- 考试的完整生命周期管理
- 基于现有题库的试卷生成
- 在线答题和自动评分
- 成绩统计和分析
- 与现有课程系统集成

**不包含功能**:
- 防作弊监控（如摄像头监控）
- 复杂的题目编辑器
- 实时语音/视频交互
- 第三方考试平台集成

### 3.2 技术边界
- 基于现有Flask架构，不引入新的框架
- 复用现有的权限系统和数据模型
- 使用现有的文件上传机制
- 保持与现有API设计风格一致

### 3.3 集成边界
- 与T07课程管理系统集成：考试关联课程
- 与T09题库管理系统集成：从题库选择题目
- 与T06用户管理系统集成：权限控制和用户信息
- 与现有认证系统集成：JWT认证和会话管理

## 4. 需求理解

### 4.1 对现有项目的理解
1. **架构模式理解**
   - 采用蓝图(Blueprint)模块化设计
   - 统一的错误处理和日志记录
   - 标准化的API响应格式
   - 完善的权限装饰器系统

2. **数据模型理解**
   - 使用SQLAlchemy ORM进行数据建模
   - 支持数据库迁移管理
   - 模型间关系清晰，支持外键约束
   - 统一的to_dict()方法用于序列化

3. **API设计理解**
   - RESTful API设计风格
   - 统一的权限验证机制
   - 支持分页、搜索、过滤
   - 完善的参数验证和错误处理

### 4.2 技术实现理解
1. **权限系统**
   - 基于Permission枚举的权限定义
   - @require_auth和@require_permission装饰器
   - 角色权限映射机制
   - 资源所有权验证

2. **数据验证**
   - 请求参数验证
   - 业务规则验证
   - 数据完整性检查
   - 统一的错误响应格式

3. **测试策略**
   - 完整的单元测试覆盖
   - 测试fixture和数据准备
   - 权限测试和边界条件测试
   - 集成测试验证

## 5. 疑问澄清

### 5.1 已解决的设计决策
1. **考试题目来源**: 基于现有题库系统，支持从题库选择题目组成试卷
2. **评分机制**: 客观题自动评分，主观题支持人工评分
3. **权限模型**: 复用现有的三角色权限系统
4. **数据存储**: 使用关系型数据库，保持与现有系统一致
5. **API设计**: 遵循现有的RESTful设计模式

### 5.2 技术实现决策
1. **考试状态管理**: 使用枚举定义考试状态，支持状态转换
2. **答题数据存储**: 使用JSON格式存储答题记录，支持灵活的题目类型
3. **时间控制**: 前后端结合实现考试时间控制和自动提交
4. **并发处理**: 使用数据库事务保证数据一致性
5. **缓存策略**: 考试进行中的答题数据实时保存到数据库

### 5.3 业务规则决策
1. **考试重复性**: 每个学生每次考试只能参加一次
2. **成绩可见性**: 考试结束后学生可查看成绩，教师可查看所有学生成绩
3. **考试修改**: 考试开始后不允许修改考试配置
4. **答案保存**: 学生答题过程中自动保存，防止数据丢失
5. **考试监控**: 教师可实时查看考试进行状态和学生答题情况

## 6. 验收标准

### 6.1 功能验收标准
1. **考试管理功能**
   - ✅ 教师可创建、编辑、删除考试
   - ✅ 支持从题库选择题目组成试卷
   - ✅ 可设置考试时间、时长、分值
   - ✅ 支持考试发布和状态管理

2. **在线考试功能**
   - ✅ 学生可在线参加考试
   - ✅ 支持多种题型的答题界面
   - ✅ 实现考试倒计时和自动提交
   - ✅ 答题过程自动保存

3. **评分功能**
   - ✅ 客观题自动评分
   - ✅ 主观题支持人工评分
   - ✅ 成绩统计和计算

4. **成绩管理功能**
   - ✅ 学生可查看个人成绩
   - ✅ 教师可查看班级成绩统计
   - ✅ 支持成绩导出功能

### 6.2 技术验收标准
1. **API接口**
   - ✅ 所有API接口符合RESTful设计
   - ✅ 完善的权限控制和参数验证
   - ✅ 统一的错误处理和响应格式
   - ✅ 支持分页、搜索、过滤功能

2. **数据模型**
   - ✅ 数据模型设计合理，关系清晰
   - ✅ 支持数据库迁移
   - ✅ 数据完整性和一致性保证

3. **集成测试**
   - ✅ 与现有系统无缝集成
   - ✅ 不影响现有功能
   - ✅ 权限系统正常工作

### 6.3 质量验收标准
1. **代码质量**
   - ✅ 遵循项目现有代码规范
   - ✅ 代码可读性和可维护性良好
   - ✅ 适当的注释和文档

2. **测试覆盖**
   - ✅ 单元测试覆盖率≥90%
   - ✅ 集成测试覆盖主要业务流程
   - ✅ 边界条件和异常情况测试

3. **性能要求**
   - ✅ API响应时间<2秒
   - ✅ 支持并发考试
   - ✅ 数据库查询优化

## 7. 风险评估

### 7.1 技术风险
- **并发考试**: 多学生同时考试可能导致性能问题
- **数据一致性**: 考试过程中的数据保存和状态管理
- **时间同步**: 前后端时间同步和考试时间控制

### 7.2 业务风险
- **考试公平性**: 防止作弊和答案泄露
- **系统稳定性**: 考试期间系统不能出现故障
- **数据安全**: 考试数据和成绩的安全保护

### 7.3 风险缓解
- 充分的测试验证
- 数据库事务保证一致性
- 前后端双重时间验证
- 完善的错误处理和日志记录

---

**文档状态**: 已完成  
**创建时间**: 2024-01-18  
**最后更新**: 2024-01-18  
**下一步**: 进入Architect阶段，设计系统架构