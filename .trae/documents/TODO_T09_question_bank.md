# T09é¢˜åº“ç®¡ç†APIå¾…åŠäº‹é¡¹æ¸…å•

## æ¦‚è¿°

T09é¢˜åº“ç®¡ç†APIé¡¹ç›®å·²æˆåŠŸå®Œæˆæ ¸å¿ƒåŠŸèƒ½å¼€å‘å’Œæµ‹è¯•ï¼Œæœ¬æ–‡æ¡£åˆ—å‡ºäº†åç»­éœ€è¦å…³æ³¨çš„ä¼˜åŒ–ç‚¹ã€é…ç½®é¡¹å’Œè¿ç»´æ³¨æ„äº‹é¡¹ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œå’ŒæŒç»­æ”¹è¿›ã€‚

## ğŸ”§ åç»­ä¼˜åŒ–ç‚¹

### 1. æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åº“ä¼˜åŒ–
- [ ] **æ·»åŠ æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**
  - ä¸º `question_banks.creator_id` æ·»åŠ ç´¢å¼•
  - ä¸º `questions.question_bank_id` æ·»åŠ å¤åˆç´¢å¼•
  - ä¸º `questions.question_type` æ·»åŠ ç´¢å¼•ä»¥ä¼˜åŒ–æŒ‰é¢˜å‹æŸ¥è¯¢
  
- [ ] **æŸ¥è¯¢ä¼˜åŒ–**
  - å®ç°é¢˜åº“åˆ—è¡¨çš„åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
  - æ·»åŠ é¢˜ç›®åˆ—è¡¨çš„æ‡’åŠ è½½æœºåˆ¶
  - è€ƒè™‘æ·»åŠ æŸ¥è¯¢ç¼“å­˜æœºåˆ¶

#### APIæ€§èƒ½ä¼˜åŒ–
- [ ] **å“åº”ä¼˜åŒ–**
  - å®ç°APIå“åº”å‹ç¼© (gzip)
  - æ·»åŠ é€‚å½“çš„HTTPç¼“å­˜å¤´
  - è€ƒè™‘å®ç°APIé™æµæœºåˆ¶

### 2. åŠŸèƒ½å¢å¼º

#### é¢˜åº“ç®¡ç†å¢å¼º
- [ ] **é¢˜åº“åˆ†ç±»ç³»ç»Ÿ**
  - æ·»åŠ é¢˜åº“åˆ†ç±»åŠŸèƒ½
  - å®ç°åˆ†ç±»å±‚çº§ç®¡ç†
  - æ”¯æŒæŒ‰åˆ†ç±»ç­›é€‰é¢˜åº“

- [ ] **é¢˜åº“ç»Ÿè®¡åŠŸèƒ½**
  - æ·»åŠ é¢˜åº“ä½¿ç”¨ç»Ÿè®¡
  - å®ç°é¢˜ç›®ç­”é¢˜ç»Ÿè®¡
  - ç”Ÿæˆé¢˜åº“åˆ†ææŠ¥å‘Š

#### é¢˜ç›®ç®¡ç†å¢å¼º
- [ ] **é¢˜ç›®å¯¼å…¥å¯¼å‡º**
  - æ”¯æŒExcelæ ¼å¼é¢˜ç›®æ‰¹é‡å¯¼å…¥
  - å®ç°é¢˜ç›®å¯¼å‡ºåŠŸèƒ½
  - æ·»åŠ é¢˜ç›®æ¨¡æ¿ä¸‹è½½

- [ ] **é¢˜ç›®ç‰ˆæœ¬ç®¡ç†**
  - å®ç°é¢˜ç›®ä¿®æ”¹å†å²è®°å½•
  - æ”¯æŒé¢˜ç›®ç‰ˆæœ¬å›æ»š
  - æ·»åŠ é¢˜ç›®å®¡æ ¸æµç¨‹

#### é«˜çº§åŠŸèƒ½
- [ ] **æ™ºèƒ½ç»„å·ç®—æ³•**
  - åŸºäºéš¾åº¦åˆ†å¸ƒçš„æ™ºèƒ½ç»„å·
  - è€ƒè™‘çŸ¥è¯†ç‚¹è¦†ç›–çš„ç»„å·ç®—æ³•
  - æ”¯æŒä¸ªæ€§åŒ–æ¨èé¢˜ç›®

- [ ] **é¢˜ç›®æ ‡ç­¾ç³»ç»Ÿ**
  - å®ç°é¢˜ç›®æ ‡ç­¾ç®¡ç†
  - æ”¯æŒå¤šç»´åº¦æ ‡ç­¾ç­›é€‰
  - æ·»åŠ æ ‡ç­¾ç»Ÿè®¡åˆ†æ

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

- [ ] **æœç´¢åŠŸèƒ½å¢å¼º**
  - å®ç°å…¨æ–‡æœç´¢åŠŸèƒ½
  - æ·»åŠ æœç´¢å†å²è®°å½•
  - æ”¯æŒé«˜çº§æœç´¢æ¡ä»¶

- [ ] **æ‰¹é‡æ“ä½œåŠŸèƒ½**
  - æ”¯æŒé¢˜ç›®æ‰¹é‡ç¼–è¾‘
  - å®ç°é¢˜ç›®æ‰¹é‡ç§»åŠ¨
  - æ·»åŠ æ‰¹é‡åˆ é™¤ç¡®è®¤æœºåˆ¶

## âš™ï¸ éœ€è¦å…³æ³¨çš„é…ç½®é¡¹

### 1. ç¯å¢ƒå˜é‡é…ç½®

#### å¿…éœ€é…ç½®é¡¹
```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=sqlite:///app.db  # ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨PostgreSQL

# JWTé…ç½®
JWT_SECRET_KEY=your-secret-key-here  # å¿…é¡»è®¾ç½®å¼ºå¯†ç 
JWT_ACCESS_TOKEN_EXPIRES=3600  # Tokenè¿‡æœŸæ—¶é—´(ç§’)

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_FOLDER=uploads  # æ–‡ä»¶ä¸Šä¼ ç›®å½•
MAX_CONTENT_LENGTH=16777216  # æœ€å¤§æ–‡ä»¶å¤§å°(16MB)
```

#### å¯é€‰é…ç½®é¡¹
```bash
# åˆ†é¡µé…ç½®
DEFAULT_PAGE_SIZE=20  # é»˜è®¤åˆ†é¡µå¤§å°
MAX_PAGE_SIZE=100     # æœ€å¤§åˆ†é¡µå¤§å°

# ç¼“å­˜é…ç½®
REDIS_URL=redis://localhost:6379/0  # Redisç¼“å­˜åœ°å€
CACHE_TIMEOUT=300  # ç¼“å­˜è¶…æ—¶æ—¶é—´(ç§’)

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO  # æ—¥å¿—çº§åˆ«
LOG_FILE=logs/app.log  # æ—¥å¿—æ–‡ä»¶è·¯å¾„
```

### 2. æ•°æ®åº“é…ç½®

#### ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“è®¾ç½®
- [ ] **PostgreSQLé…ç½®**
  ```sql
  -- å»ºè®®çš„PostgreSQLé…ç½®
  CREATE DATABASE english_tutoring_db;
  CREATE USER app_user WITH PASSWORD 'secure_password';
  GRANT ALL PRIVILEGES ON DATABASE english_tutoring_db TO app_user;
  ```

- [ ] **è¿æ¥æ± é…ç½®**
  ```python
  # SQLAlchemyè¿æ¥æ± é…ç½®
  SQLALCHEMY_ENGINE_OPTIONS = {
      'pool_size': 10,
      'pool_recycle': 3600,
      'pool_pre_ping': True
  }
  ```

### 3. å®‰å…¨é…ç½®

- [ ] **CORSé…ç½®**
  ```python
  # ç”Ÿäº§ç¯å¢ƒCORSé…ç½®
  CORS_ORIGINS = ['https://yourdomain.com']
  CORS_ALLOW_CREDENTIALS = True
  ```

- [ ] **å®‰å…¨å¤´é…ç½®**
  ```python
  # å®‰å…¨HTTPå¤´
  SECURITY_HEADERS = {
      'X-Content-Type-Options': 'nosniff',
      'X-Frame-Options': 'DENY',
      'X-XSS-Protection': '1; mode=block'
  }
  ```

## ğŸš€ è¿ç»´ç›¸å…³æ³¨æ„äº‹é¡¹

### 1. éƒ¨ç½²å‡†å¤‡

#### æœåŠ¡å™¨è¦æ±‚
- [ ] **æœ€ä½ç¡¬ä»¶è¦æ±‚**
  - CPU: 2æ ¸å¿ƒ
  - å†…å­˜: 4GB RAM
  - å­˜å‚¨: 20GB SSD
  - ç½‘ç»œ: 100Mbps

#### è½¯ä»¶ä¾èµ–
- [ ] **Pythonç¯å¢ƒ**
  ```bash
  # Python 3.8+ ç¯å¢ƒ
  python3 -m venv venv
  source venv/bin/activate
  pip install -r requirements.txt
  ```

- [ ] **æ•°æ®åº“è¿ç§»**
  ```bash
  # æ‰§è¡Œæ•°æ®åº“è¿ç§»
  flask db upgrade
  python scripts/init_data.py
  ```

### 2. ç›‘æ§å’Œæ—¥å¿—

#### æ—¥å¿—ç®¡ç†
- [ ] **æ—¥å¿—è½®è½¬é…ç½®**
  ```python
  # æ—¥å¿—è½®è½¬è®¾ç½®
  import logging.handlers
  handler = logging.handlers.RotatingFileHandler(
      'logs/app.log', maxBytes=10485760, backupCount=5
  )
  ```

#### ç›‘æ§æŒ‡æ ‡
- [ ] **å…³é”®ç›‘æ§æŒ‡æ ‡**
  - APIå“åº”æ—¶é—´
  - æ•°æ®åº“è¿æ¥æ•°
  - å†…å­˜ä½¿ç”¨ç‡
  - ç£ç›˜ç©ºé—´ä½¿ç”¨
  - é”™è¯¯ç‡ç»Ÿè®¡

### 3. å¤‡ä»½ç­–ç•¥

- [ ] **æ•°æ®åº“å¤‡ä»½**
  ```bash
  # æ¯æ—¥æ•°æ®åº“å¤‡ä»½è„šæœ¬
  #!/bin/bash
  DATE=$(date +%Y%m%d_%H%M%S)
  pg_dump english_tutoring_db > backup_$DATE.sql
  ```

- [ ] **æ–‡ä»¶å¤‡ä»½**
  ```bash
  # ä¸Šä¼ æ–‡ä»¶å¤‡ä»½
  rsync -av uploads/ backup/uploads_$(date +%Y%m%d)/
  ```

### 4. å®‰å…¨ç»´æŠ¤

- [ ] **å®šæœŸå®‰å…¨æ£€æŸ¥**
  - æ£€æŸ¥ä¾èµ–åŒ…å®‰å…¨æ¼æ´
  - æ›´æ–°å®‰å…¨è¡¥ä¸
  - å®¡æŸ¥è®¿é—®æ—¥å¿—
  - æ£€æŸ¥å¼‚å¸¸ç™»å½•

- [ ] **å¯†é’¥ç®¡ç†**
  - å®šæœŸè½®æ¢JWTå¯†é’¥
  - ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
  - é¿å…åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥

## ğŸ”— ä¸å‰ç«¯é›†æˆçš„å‡†å¤‡å·¥ä½œ

### 1. APIæ–‡æ¡£å‡†å¤‡

- [ ] **Swagger/OpenAPIæ–‡æ¡£**
  ```python
  # æ·»åŠ APIæ–‡æ¡£ç”Ÿæˆ
  from flask_restx import Api, Resource
  
  api = Api(app, doc='/api/docs/')
  ```

- [ ] **APIä½¿ç”¨ç¤ºä¾‹**
  ```javascript
  // å‰ç«¯è°ƒç”¨ç¤ºä¾‹
  const response = await fetch('/api/question-banks', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  });
  ```

### 2. å‰ç«¯å¼€å‘æ”¯æŒ

#### TypeScriptç±»å‹å®šä¹‰
- [ ] **ç”ŸæˆTypeScriptæ¥å£**
  ```typescript
  // é¢˜åº“æ¥å£å®šä¹‰
  interface QuestionBank {
    id: number;
    name: string;
    description?: string;
    creator_id: number;
    is_active: boolean;
    created_at: string;
    updated_at: string;
  }
  
  interface Question {
    id: number;
    question_bank_id: number;
    question_type: 'single_choice' | 'multiple_choice' | 'fill_blank' | 'essay';
    content: string;
    options?: string[];
    correct_answer: string;
    difficulty: number;
    media_files?: string[];
  }
  ```

#### å‰ç«¯SDKå¼€å‘
- [ ] **JavaScript SDK**
  ```javascript
  // é¢˜åº“ç®¡ç†SDK
  class QuestionBankAPI {
    constructor(baseURL, token) {
      this.baseURL = baseURL;
      this.token = token;
    }
    
    async getQuestionBanks(page = 1, pageSize = 20) {
      // å®ç°è·å–é¢˜åº“åˆ—è¡¨
    }
    
    async createQuestionBank(data) {
      // å®ç°åˆ›å»ºé¢˜åº“
    }
  }
  ```

### 3. è·¨åŸŸå’Œè®¤è¯

- [ ] **CORSé…ç½®ä¼˜åŒ–**
  ```python
  # é’ˆå¯¹å‰ç«¯çš„CORSé…ç½®
  from flask_cors import CORS
  
  CORS(app, origins=[
    'http://localhost:3000',  # å¼€å‘ç¯å¢ƒ
    'https://yourdomain.com'  # ç”Ÿäº§ç¯å¢ƒ
  ])
  ```

- [ ] **Tokenåˆ·æ–°æœºåˆ¶**
  ```python
  # å®ç°Tokenè‡ªåŠ¨åˆ·æ–°
  @app.route('/api/auth/refresh', methods=['POST'])
  def refresh_token():
      # Tokenåˆ·æ–°é€»è¾‘
      pass
  ```

## ğŸ“‹ ä¼˜å…ˆçº§æ’åº

### é«˜ä¼˜å…ˆçº§ (å»ºè®®1ä¸ªæœˆå†…å®Œæˆ)
1. âœ… ç¯å¢ƒå˜é‡é…ç½®å®Œå–„
2. âœ… ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“é…ç½®
3. âœ… åŸºç¡€ç›‘æ§å’Œæ—¥å¿—é…ç½®
4. âœ… APIæ–‡æ¡£ç”Ÿæˆ
5. âœ… å‰ç«¯TypeScriptç±»å‹å®šä¹‰

### ä¸­ä¼˜å…ˆçº§ (å»ºè®®3ä¸ªæœˆå†…å®Œæˆ)
1. ğŸ”„ æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
2. ğŸ”„ é¢˜åº“åˆ†ç±»ç³»ç»Ÿ
3. ğŸ”„ é¢˜ç›®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
4. ğŸ”„ æœç´¢åŠŸèƒ½å¢å¼º
5. ğŸ”„ å‰ç«¯SDKå¼€å‘

### ä½ä¼˜å…ˆçº§ (å»ºè®®6ä¸ªæœˆå†…å®Œæˆ)
1. â³ æ™ºèƒ½ç»„å·ç®—æ³•
2. â³ é¢˜ç›®ç‰ˆæœ¬ç®¡ç†
3. â³ é¢˜ç›®æ ‡ç­¾ç³»ç»Ÿ
4. â³ é«˜çº§ç»Ÿè®¡åˆ†æ
5. â³ æ€§èƒ½ç¼“å­˜ä¼˜åŒ–

## ğŸ†˜ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. æ•°æ®åº“ç›¸å…³

**é—®é¢˜**: æ•°æ®åº“è¿æ¥è¶…æ—¶
```python
# è§£å†³æ–¹æ¡ˆ: é…ç½®è¿æ¥æ± 
SQLALCHEMY_ENGINE_OPTIONS = {
    'pool_pre_ping': True,
    'pool_recycle': 300
}
```

**é—®é¢˜**: è¿ç§»å¤±è´¥
```bash
# è§£å†³æ–¹æ¡ˆ: é‡ç½®è¿ç§»
flask db stamp head
flask db migrate
flask db upgrade
```

### 2. æ€§èƒ½ç›¸å…³

**é—®é¢˜**: APIå“åº”æ…¢
```python
# è§£å†³æ–¹æ¡ˆ: æ·»åŠ æŸ¥è¯¢ä¼˜åŒ–
from sqlalchemy.orm import joinedload

questions = Question.query.options(
    joinedload(Question.question_bank)
).all()
```

**é—®é¢˜**: å†…å­˜ä½¿ç”¨è¿‡é«˜
```python
# è§£å†³æ–¹æ¡ˆ: å®ç°åˆ†é¡µæŸ¥è¯¢
def get_questions_paginated(page=1, per_page=20):
    return Question.query.paginate(
        page=page, per_page=per_page, error_out=False
    )
```

### 3. å®‰å…¨ç›¸å…³

**é—®é¢˜**: JWT Tokenæ³„éœ²
```python
# è§£å†³æ–¹æ¡ˆ: å®ç°Tokené»‘åå•
blacklisted_tokens = set()

def is_token_blacklisted(token):
    return token in blacklisted_tokens
```

## ğŸ“ æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼

- **é¡¹ç›®è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
- **æŠ€æœ¯æ–‡æ¡£**: `.trae/documents/` ç›®å½•
- **é—®é¢˜åé¦ˆ**: é€šè¿‡é¡¹ç›®ç®¡ç†ç³»ç»Ÿæäº¤
- **ç´§æ€¥è”ç³»**: æŒ‰ç…§å›¢é˜Ÿåº”æ€¥å“åº”æµç¨‹

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä¼šæ ¹æ®é¡¹ç›®å‘å±•å’Œå®é™…éœ€æ±‚è¿›è¡Œå®šæœŸæ›´æ–°ï¼Œå»ºè®®æ¯æœˆreviewä¸€æ¬¡å¾…åŠäº‹é¡¹çš„å®Œæˆæƒ…å†µã€‚

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025-01-17*  
*æ–‡æ¡£ç‰ˆæœ¬: 1.0*  
*ä¸‹æ¬¡æ›´æ–°: 2025-02-17*